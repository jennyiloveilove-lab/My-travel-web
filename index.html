<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…æ—¥è¨˜ Pro V17 ğŸŒ¸</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f8fbfb; font-family: 'Zen Maru Gothic', sans-serif; color: #2d5a5a; }
        .app-container { max-width: 480px; margin: 0 auto; background: #ffffff; min-height: 100vh; position: relative; padding-bottom: 120px; }
        .bg-aqua { background-color: #64cccc; }
        /* åƒè€ƒæˆªåœ–çš„åœ“è§’èˆ‡é™°å½± */
        .weather-box { background-color: rgba(255, 255, 255, 0.25); backdrop-filter: blur(5px); border-radius: 20px; padding: 12px 16px; }
        .day-pill { background-color: white; border-radius: 18px; padding: 10px 20px; box-shadow: 0 4px 12px rgba(100,204,204,0.15); }
        .event-card { border-radius: 25px; border: 1px solid #f0f7f7; box-shadow: 0 6px 15px rgba(0,0,0,0.03); overflow: hidden; position: relative; }
        .category-chip { background: #f0f9f9; color: #64cccc; padding: 4px 12px; border-radius: 8px; font-size: 11px; font-weight: bold; }
        .currency-btn { padding: 6px 14px; border-radius: 12px; font-size: 12px; font-weight: 800; transition: 0.2s; background: #e0f2f2; }
        .currency-active { background: #64cccc; color: white; }
    </style>
</head>
<body>

<div id="app" class="app-container">
    <header class="bg-aqua text-white p-6 rounded-b-[3rem] shadow-lg sticky top-0 z-20">
        <div class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-3">
                <span class="text-2xl font-bold">{{ currentTime }}</span>
                <span class="bg-white/30 px-3 py-1 rounded-full text-[11px]">{{ currentLocationName }}</span>
            </div>
            <button @click="showSettings = true" class="text-xl opacity-80 active:scale-90"><i class="fa-solid fa-calendar-day"></i></button>
        </div>

        <div class="weather-box flex items-center gap-3 mb-6">
            <span class="text-2xl">â˜€ï¸</span>
            <div>
                <p class="text-sm font-bold">{{ weatherTemp }}Â° C <span class="text-[10px] font-normal opacity-80">æ–¼ç•¶åœ°</span></p>
                <p class="text-[11px] opacity-90 font-medium">â˜€ï¸ å¤©æ°£å¥½æ­£ï¼Œé©åˆè¡Œè¡—ï¼</p>
            </div>
        </div>

        <div v-if="dailyTotalHKD > 0" class="bg-white/10 p-4 rounded-[20px] border border-white/20 flex justify-between items-center mb-4">
            <div>
                <p class="text-[9px] font-bold uppercase tracking-widest opacity-70">ä»Šæ—¥ç¸½é–‹æ”¯ (HKD)</p>
                <p class="text-xl font-black">$ {{ dailyTotalHKD.toFixed(1) }}</p>
            </div>
            <div class="text-right flex gap-2 overflow-x-auto no-scrollbar max-w-[150px]">
                 <span v-for="stat in categoryStats" class="text-[10px] bg-white/20 px-2 py-1 rounded-lg whitespace-nowrap">
                    {{ stat.emoji }} ${{ stat.totalHKD.toFixed(0) }}
                 </span>
            </div>
        </div>

        <div class="flex gap-3 overflow-x-auto no-scrollbar py-2">
            <div v-for="(day, i) in itinerary" :key="i" @click="activeDayIdx = i"
                :class="activeDayIdx === i ? 'day-pill text-[#64cccc]' : 'bg-white/20 text-white'"
                class="flex-shrink-0 px-5 py-2 rounded-[18px] text-center min-w-[85px] cursor-pointer transition-all">
                <p class="text-[9px] font-bold">{{ getDayOfWeek(i) }}</p>
                <p class="text-sm font-bold">{{ getDisplayDate(i) }}</p>
            </div>
            <button @click="addDay" class="bg-white/10 px-4 rounded-[18px] border-2 border-dashed border-white/30">+</button>
        </div>
    </header>

    <main class="p-5 space-y-6">
        <div ref="sortableList" class="space-y-4">
            <div v-for="(event, eIdx) in itinerary[activeDayIdx].events" :key="event.id" 
                @click="openEditModal(eIdx)" class="event-card bg-white p-5 border-l-[6px]" :style="{ borderColor: getCategoryColor(event.category) }">
                
                <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-gray-400">{{ event.time }}</span>
                        <span class="category-chip">{{ getCategoryName(event.category) }}</span>
                    </div>
                    <div v-if="event.cost > 0" class="text-right">
                        <p class="text-sm font-black text-rose-400">
                            {{ event.currency === 'JPY' ? 'Â¥' : 'HK$' }}{{ event.cost.toLocaleString() }}
                        </p>
                        <p class="text-[9px] text-gray-300 font-bold">æŠ˜åˆ HK$ {{ getEventHKD(event).toFixed(1) }}</p>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <span class="text-xl">{{ getCategoryEmoji(event.category) }}</span>
                    <h3 class="text-lg font-bold text-[#2d5a5a]">{{ event.location }}</h3>
                </div>
                
                <p v-if="event.note" class="text-xs text-gray-400 mt-2 italic">"{{ event.note }}"</p>
            </div>
        </div>

        <div v-if="itinerary[activeDayIdx].events.length === 0" class="text-center py-20">
            <p class="text-gray-300 text-sm">ä»Šæ—¥ä»²æœªæœ‰è¡Œç¨‹ï¼Œæ’³ + åŠ ä¸€å€‹å•¦ï¼</p>
        </div>
    </main>

    <button @click="addNewEvent" class="fixed bottom-10 right-8 bg-[#64cccc] text-white w-14 h-14 rounded-full shadow-2xl flex items-center justify-center text-2xl active:scale-90 transition-all">
        <i class="fa-solid fa-plus"></i>
    </button>

    <div v-if="showEditModal" class="fixed inset-0 bg-black/50 z-[100] flex items-end">
        <div class="bg-white w-full rounded-t-[3rem] p-8 max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl">âœ¨ {{ isNew ? 'æ–°å¢è¡Œç¨‹' : 'ç·¨è¼¯è¡Œç¨‹' }}</h3>
                <button @click="showEditModal = false"><i class="fa-solid fa-xmark text-gray-300 text-xl"></i></button>
            </div>

            <div class="space-y-6">
                <div class="flex gap-2 overflow-x-auto no-scrollbar py-1">
                    <button v-for="cat in categories" :key="cat.id" @click="editingEvent.category = cat.id"
                        :class="editingEvent.category === cat.id ? 'bg-[#64cccc] text-white' : 'bg-[#f0f9f9] text-gray-400'"
                        class="px-5 py-3 rounded-2xl text-xs font-bold flex-shrink-0 flex flex-col items-center min-w-[70px]">
                        <span class="text-xl mb-1">{{ cat.emoji }}</span>{{ cat.name }}
                    </button>
                </div>

                <div class="flex gap-3">
                    <input v-model="editingEvent.time" type="time" class="p-4 bg-[#f0f9f9] rounded-2xl flex-1 font-bold">
                    <input v-model="editingEvent.location" type="text" placeholder="å»é‚Šåº¦ï¼Ÿ" class="p-4 bg-[#f0f9f9] rounded-2xl flex-[2.5] font-bold outline-none">
                </div>

                <textarea v-model="editingEvent.note" placeholder="å‚™è¨»..." class="w-full p-5 bg-[#f0f9f9] rounded-2xl h-24 text-sm outline-none resize-none"></textarea>

                <div class="bg-[#f0f9f9] p-6 rounded-[2rem]">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-xs font-bold text-[#64cccc]">è¼¸å…¥è²¨å¹£</span>
                        <div class="flex gap-2">
                            <button @click="editingEvent.currency = 'JPY'" :class="editingEvent.currency === 'JPY' ? 'currency-active' : ''" class="currency-btn">JPY Â¥</button>
                            <button @click="editingEvent.currency = 'HKD'" :class="editingEvent.currency === 'HKD' ? 'currency-active' : ''" class="currency-btn">HKD $</button>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <span class="text-xl font-black mr-3 text-[#64cccc]">{{ editingEvent.currency === 'JPY' ? 'Â¥' : '$' }}</span>
                        <input v-model.number="editingEvent.cost" type="number" class="bg-transparent flex-1 outline-none font-bold text-2xl" placeholder="0">
                    </div>
                    <div v-if="editingEvent.currency === 'JPY'" class="mt-3 pt-3 border-t border-white flex justify-between">
                        <span class="text-[10px] text-gray-400 font-bold uppercase">æŠ˜åˆæ¸¯å¹£</span>
                        <span class="text-xs font-black text-rose-400">â‰ˆ HK$ {{ (editingEvent.cost * exchangeRate).toFixed(1) }}</span>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 mt-8">
                <button v-if="!isNew" @click="deleteEvent" class="flex-1 py-4 text-rose-400 font-bold">åˆªé™¤</button>
                <button @click="saveEvent" class="flex-[3] bg-[#64cccc] text-white py-4 rounded-2xl font-bold shadow-lg">å„²å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;
createApp({
    data() {
        return {
            activeDayIdx: 0,
            showEditModal: false,
            isNew: true,
            editingIdx: -1,
            currentTime: '23:37',
            currentLocationName: 'æ±äº¬',
            weatherTemp: 13,
            exchangeRate: 0.052,
            startDate: '2026-01-11',
            itinerary: [{ events: [] }],
            categories: [
                { id: 'spot', name: 'æ™¯é»', emoji: 'ğŸŒ¸', color: '#64cccc' },
                { id: 'eat', name: 'é£²é£Ÿ', emoji: 'ğŸ±', color: '#ffb347' },
                { id: 'shop', name: 'è³¼ç‰©', emoji: 'ğŸ›ï¸', color: '#f4a460' },
                { id: 'transport', name: 'äº¤é€š', emoji: 'ğŸšƒ', color: '#88babb' }
            ],
            editingEvent: { id: 0, time: '12:00', location: '', cost: 0, note: '', currency: 'JPY', category: 'spot' }
        }
    },
    methods: {
        getEventHKD(event) {
            if (!event.cost) return 0;
            return event.currency === 'JPY' ? event.cost * this.exchangeRate : event.cost;
        },
        getDisplayDate(i) {
            const d = new Date(this.startDate); d.setDate(d.getDate() + i);
            return `${d.getMonth() + 1}/${d.getDate()}`;
        },
        getDayOfWeek(i) {
            const d = new Date(this.startDate); d.setDate(d.getDate() + i);
            return ['é€±æ—¥','é€±ä¸€','é€±äºŒ','é€±ä¸‰','é€±å››','é€±äº”','é€±å…­'][d.getDay()];
        },
        getCategoryEmoji(id) { return this.categories.find(c => c.id === id)?.emoji || 'ğŸ“'; },
        getCategoryName(id) { return this.categories.find(c => c.id === id)?.name || 'è¡Œç¨‹'; },
        getCategoryColor(id) { return this.categories.find(c => c.id === id)?.color || '#64cccc'; },
        addNewEvent() {
            this.isNew = true;
            this.editingEvent = { id: Date.now(), time: '12:00', location: '', cost: 0, note: '', currency: 'JPY', category: 'spot' };
            this.showEditModal = true;
        },
        openEditModal(idx) {
            this.isNew = false; this.editingIdx = idx;
            this.editingEvent = JSON.parse(JSON.stringify(this.itinerary[this.activeDayIdx].events[idx]));
            this.showEditModal = true;
        },
        saveEvent() {
            if(!this.editingEvent.location) return;
            if(this.isNew) this.itinerary[this.activeDayIdx].events.push({...this.editingEvent});
            else this.itinerary[this.activeDayIdx].events[this.editingIdx] = {...this.editingEvent};
            this.itinerary[this.activeDayIdx].events.sort((a,b) => a.time.localeCompare(b.time));
            this.showEditModal = false; this.saveToLocal();
        },
        deleteEvent() {
            if(confirm('åˆªé™¤å‘¢å€‹è¡Œç¨‹ï¼Ÿ')) { this.itinerary[this.activeDayIdx].events.splice(this.editingIdx, 1); this.showEditModal = false; this.saveToLocal(); }
        },
        addDay() { this.itinerary.push({ events: [] }); this.saveToLocal(); },
        saveToLocal() { localStorage.setItem('travel_v17', JSON.stringify({ i: this.itinerary, s: this.startDate })); }
    },
    computed: {
        dailyTotalHKD() {
            return this.itinerary[this.activeDayIdx].events.reduce((sum, e) => sum + this.getEventHKD(e), 0);
        },
        categoryStats() {
            return this.categories.map(cat => {
                const totalHKD = this.itinerary[this.activeDayIdx].events
                    .filter(e => e.category === cat.id)
                    .reduce((sum, e) => sum + this.getEventHKD(e), 0);
                return { ...cat, totalHKD };
            }).filter(s => s.totalHKD > 0);
        }
    },
    mounted() {
        const saved = JSON.parse(localStorage.getItem('travel_v17'));
        if(saved) { this.itinerary = saved.i; this.startDate = saved.s; }
        Sortable.create(this.$refs.sortableList, { animation: 200, onEnd: () => this.saveToLocal() });
    }
}).mount('#app');
</script>
</body>
</html>