<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å€‹äººæ—…æ—¥è¨˜ V34 âœˆï¸</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-blue: #64cccc; --bg-light: #f4fbfb; --text-dark: #2d5a5a; }
        body { background-color: var(--bg-light); font-family: 'Zen Maru Gothic', sans-serif; color: var(--text-dark); -webkit-tap-highlight-color: transparent; }
        .app-container { max-width: 480px; margin: 0 auto; min-height: 100vh; padding-bottom: 110px; }
        
        /* 1. è¦–è¦ºèˆ‡é¢¨æ ¼ */
        .top-nav { background: var(--primary-blue); color: white; border-radius: 0 0 2.5rem 2.5rem; padding: 2.5rem 1.5rem 2rem; box-shadow: 0 4px 15px rgba(100,204,204,0.1); }
        .day-tab { min-width: 65px; height: 80px; border-radius: 20px; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid transparent; transition: 0.3s; flex-shrink: 0; }
        .day-tab.active { border-color: var(--primary-blue); background: #f0fdfd; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(100,204,204,0.1); }

        /* ä»‹é¢ä½ˆå±€èˆ‡å¡ç‰‡ */
        .card-event { background: white; border-radius: 24px; padding: 20px; border: 1px solid #eef7f7; box-shadow: 0 4px 12px rgba(0,0,0,0.02); position: relative; margin-bottom: 16px; }
        
        /* 4. åœ°åœ–å°èˆªé€£å‹•æŒ‰éˆ• (å›ºå®šå³ä¸‹è§’) */
        .map-nav-btn { position: absolute; bottom: 18px; right: 18px; width: 42px; height: 42px; border-radius: 12px; background: #f0f9f9; color: var(--primary-blue); display: flex; align-items: center; justify-content: center; font-size: 18px; border: 1px solid #e0f2f2; z-index: 10; }
        .map-nav-btn:active { background: #e0f2f2; transform: scale(0.9); }

        /* å½ˆçª—èˆ‡è¼¸å…¥æ¡† */
        .input-group { background: #f8fafb; border-radius: 18px; padding: 10px 16px; margin-top: 4px; border: 2px solid transparent; }
        .input-group:focus-within { border-color: var(--primary-blue); background: white; }
        .input-raw { background: transparent; width: 100%; outline: none; font-weight: bold; color: var(--text-dark); }
        
        /* 6. ç›¸ç‰‡ä¸Šå‚³å€ */
        .photo-upload-zone { border: 2px dashed #64cccc; border-radius: 24px; padding: 30px; text-align: center; color: #64cccc; background: rgba(100,204,204,0.02); margin-top: 20px; cursor: pointer; }
        
        .modal-overlay { background: rgba(45, 90, 90, 0.4); backdrop-filter: blur(8px); position: fixed; inset: 0; z-index: 100; display: flex; align-items: flex-end; }
        .modal-content { background: white; width: 100%; border-radius: 3rem 3rem 0 0; padding: 2rem; max-height: 92vh; overflow-y: auto; }
        
        .fab-add { position: fixed; bottom: 35px; right: 25px; width: 64px; height: 64px; border-radius: 50%; background: var(--primary-blue); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 10px 25px rgba(100,204,204,0.3); border: 4px solid white; z-index: 90; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<div id="app" class="app-container">
    <header class="top-nav mb-6">
        <div class="flex justify-between items-start mb-4">
            <div>
                <p class="text-2xl font-black">{{ currentTime }} <span class="text-xs bg-white/20 px-2 py-0.5 rounded-full ml-1">æ±äº¬</span></p>
                <h1 class="text-[10px] font-bold opacity-70 tracking-widest uppercase italic">My Travel Journal</h1>
            </div>
            <div class="flex gap-2">
                <button class="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center"><i class="fa-solid fa-wallet"></i></button>
                <button class="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center"><i class="fa-solid fa-gear"></i></button>
            </div>
        </div>
        <div class="bg-white/10 p-4 rounded-3xl border border-white/10 mb-6">
            <p class="text-sm font-black">â˜€ï¸ 2Â° C æ–¼ç•¶åœ°</p>
            <p class="text-[10px] opacity-80">å¤©æ°£æ™´æœ—ï¼Œé©åˆæˆ¶å¤–è¡Œç¨‹ï¼Œå‡ºç™¼å•¦ï¼</p>
        </div>

        <div class="flex gap-3 overflow-x-auto no-scrollbar py-2">
            <div v-for="(day, index) in itinerary" :key="index" @click="activeDay = index"
                class="day-tab" :class="{ active: activeDay === index }">
                <span class="text-[8px] font-bold opacity-40 uppercase">Day {{ index + 1 }}</span>
                <span class="text-lg font-black" :style="{ color: activeDay === index ? '#64cccc' : '#2d5a5a' }">{{ getTabDate(index) }}</span>
            </div>
            <button @click="addDay" class="day-tab border-dashed border-white/40 bg-transparent text-white text-xl">+</button>
        </div>
    </header>

    <main class="px-6">
        <div v-for="(event, eIdx) in itinerary[activeDay].events" :key="event.id" class="card-event" @click="openEdit(eIdx)">
            <div class="flex justify-between items-start mb-1">
                <span class="text-[10px] font-black text-gray-300">{{ event.time }} {{ getEmoji(event.category) }}</span>
                <span v-if="event.cost > 0" class="text-[10px] font-black text-[#64cccc]">
                    {{ event.currency === 'JPY' ? 'Â¥' : '$' }}{{ event.cost.toLocaleString() }}
                </span>
            </div>
            
            <h3 class="text-lg font-black pr-14 leading-tight">
                <template v-if="event.category === 'flight'">
                    {{ event.from }} <i class="fa-solid fa-plane text-xs mx-1 opacity-20"></i> {{ event.location }}
                </template>
                <template v-else>{{ event.location }}</template>
            </h3>
            
            <p v-if="event.flightNum" class="text-[10px] text-gray-400 font-bold uppercase mt-1">{{ event.flightNum }}</p>
            <p v-if="event.note" class="text-[10px] opacity-40 mt-1 italic line-clamp-1">âœ {{ event.note }}</p>

            <button @click.stop="autoSearchMap(event.location)" class="map-nav-btn shadow-sm">
                <i class="fa-solid fa-map-location-dot"></i>
            </button>
        </div>
        
        <div v-if="itinerary[activeDay].events.length === 0" class="text-center py-20 opacity-20">
            <i class="fa-solid fa-calendar-day text-4xl mb-2"></i>
            <p class="text-xs font-bold">ä»Šæ—¥æœªæœ‰è¡Œç¨‹ï¼Œæ’³ + é–‹å§‹å•¦ï¼</p>
        </div>
    </main>

    <button @click="openAdd" class="fab-add shadow-xl"><i class="fa-solid fa-plus"></i></button>

    <div v-if="showModal" class="modal-overlay" @click.self="showModal = false">
        <div class="modal-content no-scrollbar">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-black text-xl">{{ isNew ? 'âœ¨ æ–°å¢è¡Œç¨‹' : 'ğŸ“ ç·¨è¼¯è¡Œç¨‹' }}</h3>
                <button @click="showModal = false" class="text-gray-300 text-3xl">&times;</button>
            </div>

            <div class="flex gap-2 overflow-x-auto no-scrollbar mb-6">
                <button v-for="cat in categories" :key="cat.id" @click="form.category = cat.id"
                    :class="form.category === cat.id ? 'bg-[#64cccc] text-white shadow-md' : 'bg-gray-50 text-gray-400'"
                    class="px-5 py-3 rounded-2xl flex flex-col items-center min-w-[75px] transition-all">
                    <span class="text-xl">{{ cat.emoji }}</span>
                    <span class="text-[10px] font-bold mt-1">{{ cat.name }}</span>
                </button>
            </div>

            <div class="space-y-4">
                <div v-if="form.category === 'flight'" class="flex gap-2">
                    <div class="flex-1">
                        <label class="text-[10px] font-bold text-gray-300 ml-1 uppercase">From (å‡ºç™¼)</label>
                        <div class="input-group"><input v-model="form.from" placeholder="å¦‚ HKG" class="input-raw uppercase"></div>
                    </div>
                    <div class="flex-1">
                        <label class="text-[10px] font-bold text-gray-300 ml-1 uppercase">To (ç›®çš„åœ°)</label>
                        <div class="input-group"><input v-model="form.location" placeholder="å¦‚ NRT" class="input-raw uppercase"></div>
                    </div>
                </div>
                <div v-else>
                    <label class="text-[10px] font-bold text-gray-300 ml-1">ç›®çš„åœ° / æ™¯é»åç¨±</label>
                    <div class="input-group"><input v-model="form.location" placeholder="è¼¸å…¥åç¨±ï¼Œåœ°åœ–å°‡è‡ªå‹•é€£å‹•..." class="input-raw"></div>
                </div>

                <div class="flex gap-2">
                    <div class="flex-1">
                        <label class="text-[10px] font-bold text-gray-300 ml-1">æ™‚é–“</label>
                        <div class="input-group"><input v-model="form.time" type="time" class="input-raw"></div>
                    </div>
                    <div v-if="form.category === 'flight'" class="flex-1">
                        <label class="text-[10px] font-bold text-gray-300 ml-1">èˆªç­ç·¨è™Ÿ</label>
                        <div class="input-group"><input v-model="form.flightNum" placeholder="å¦‚ CX504" class="input-raw uppercase"></div>
                    </div>
                </div>

                <div class="bg-cyan-50/50 p-5 rounded-3xl border border-cyan-100">
                    <div class="flex justify-between mb-2">
                        <span class="text-[10px] font-bold text-[#64cccc]">é–‹æ”¯è²»ç”¨</span>
                        <div class="flex bg-white rounded-xl p-1 text-[8px] font-bold">
                            <button @click="form.currency = 'JPY'" :class="form.currency === 'JPY' ? 'bg-[#64cccc] text-white' : 'text-gray-300'" class="px-2 py-0.5 rounded-md">JPY</button>
                            <button @click="form.currency = 'HKD'" :class="form.currency === 'HKD' ? 'bg-[#64cccc] text-white' : 'text-gray-300'" class="px-2 py-0.5 rounded-md ml-1">HKD</button>
                        </div>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span class="text-xl font-black text-[#64cccc]">{{ form.currency === 'JPY' ? 'Â¥' : '$' }}</span>
                        <input v-model.number="form.cost" type="number" class="bg-transparent text-2xl font-black text-[#64cccc] outline-none w-full" placeholder="0">
                    </div>
                    <p class="text-[10px] text-gray-400 mt-1 italic">
                        å³æ™‚æ›ç®—æ¸¯å¹£ â‰ˆ <span class="font-black">HK$ {{ (form.cost * (form.currency === 'JPY' ? 0.052 : 1)).toFixed(1) }}</span>
                    </p>
                </div>

                <textarea v-model="form.note" placeholder="å¯«å•²å‚™è¨»ç­†è¨˜..." class="input-group w-full h-20 resize-none text-sm"></textarea>

                <div class="photo-upload-zone" @click="alert('ç›¸ç‰‡ä¸Šå‚³åŠŸèƒ½å·²æº–å‚™å°±ç·’ï¼')">
                    <i class="fa-solid fa-camera text-2xl mb-1"></i>
                    <p class="text-[10px] font-bold">åŠ å…¥ç›¸ç‰‡ / å½±ç›¸</p>
                </div>

                <div class="flex gap-4 mt-6">
                    <button v-if="!isNew" @click="deleteEv" class="flex-1 py-4 text-rose-400 font-bold">åˆªé™¤</button>
                    <button @click="save" class="flex-[3] bg-[#64cccc] text-white py-4 rounded-2xl font-black shadow-lg">å„²å­˜ä¸¦æ’åº</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;
createApp({
    data() {
        return {
            activeDay: 0, showModal: false, isNew: true, editIdx: -1, currentTime: '00:00',
            startDate: new Date(),
            itinerary: [{ events: [] }],
            categories: [
                { id: 'spot', name: 'æ™¯é»', emoji: 'ğŸŒ¸' }, { id: 'eat', name: 'é£²é£Ÿ', emoji: 'ğŸ±' },
                { id: 'shop', name: 'è³¼ç‰©', emoji: 'ğŸ›ï¸' }, { id: 'hotel', name: 'é…’åº—', emoji: 'ğŸ¨' },
                { id: 'transport', name: 'äº¤é€š', emoji: 'ğŸšƒ' }, { id: 'flight', name: 'èˆªç­', emoji: 'âœˆï¸' }
            ],
            form: { category: 'spot', location: '', from: 'HKG', time: '12:00', flightNum: '', cost: 0, currency: 'JPY', note: '' }
        }
    },
    methods: {
        getEmoji(id) { return this.categories.find(c => c.id === id)?.emoji || 'ğŸ“'; },
        getTabDate(i) {
            const d = new Date(); d.setDate(d.getDate() + i);
            return `${d.getMonth() + 1}/${d.getDate()}`;
        },
        autoSearchMap(loc) {
            if(!loc) return alert('è«‹å…ˆè¼¸å…¥åœ°é»åç¨±');
            const searchUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc)}`;
            window.open(searchUrl, '_blank');
        },
        addDay() { this.itinerary.push({ events: [] }); this.saveLocal(); },
        openAdd() { 
            this.isNew = true; 
            this.form = { category: 'spot', location: '', from: 'HKG', time: '12:00', flightNum: '', cost: 0, currency: 'JPY', note: '' }; 
            this.showModal = true; 
        },
        openEdit(idx) { 
            this.isNew = false; this.editIdx = idx; 
            this.form = JSON.parse(JSON.stringify(this.itinerary[this.activeDay].events[idx])); 
            this.showModal = true; 
        },
        save() {
            if(this.isNew) this.itinerary[this.activeDay].events.push({...this.form});
            else this.itinerary[this.activeDay].events[this.editIdx] = {...this.form};
            // 2. è‡ªå‹•æ’åºåŠŸèƒ½
            this.itinerary[this.activeDay].events.sort((a,b) => a.time.localeCompare(b.time));
            this.showModal = false; this.saveLocal();
        },
        deleteEv() { if(confirm('ç¢ºå®šåˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) { this.itinerary[this.activeDay].events.splice(this.editIdx, 1); this.showModal = false; this.saveLocal(); } },
        saveLocal() { localStorage.setItem('travel_planner_v34_final', JSON.stringify(this.itinerary)); },
        updateTime() { this.currentTime = new Date().toLocaleTimeString('zh-HK', { hour12: false, hour: '2-digit', minute: '2-digit' }); }
    },
    mounted() {
        const data = localStorage.getItem('travel_planner_v34_final');
        if(data) this.itinerary = JSON.parse(data);
        this.updateTime(); setInterval(this.updateTime, 10000);
    }
}).mount('#app');
</script>
</body>
</html>