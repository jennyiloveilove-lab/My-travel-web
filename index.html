<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…æ—¥è¨˜ Pro V13 ğŸŒ¸</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f0f9f9; font-family: 'Zen Maru Gothic', sans-serif; color: #2d5a5a; -webkit-tap-highlight-color: transparent; }
        .app-container { max-width: 480px; margin: 0 auto; background: #ffffff; min-height: 100vh; position: relative; padding-bottom: 120px; }
        .bg-aqua { background-color: #64cccc; }
        .day-tab-active { background-color: white !important; color: #64cccc !important; transform: scale(1.05); box-shadow: 0 4px 15px rgba(100,204,204,0.3); }
        .day-tab-normal { background-color: rgba(255,255,255,0.2) !important; color: white !important; opacity: 0.9; }
        .kawaii-card { border-radius: 28px; background: #fff; border: 1px solid #f0f7f7; box-shadow: 0 6px 20px rgba(0,0,0,0.04); }
        .img-box { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 20px; margin-top: 12px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .category-btn-active { background-color: #64cccc !important; color: white !important; transform: translateY(-2px); }
    </style>
</head>
<body>

<div id="app" class="app-container">
    <header class="bg-aqua text-white p-6 rounded-b-[3rem] shadow-lg sticky top-0 z-20">
        <div class="flex justify-between items-start">
            <div class="flex-1">
                <h1 class="text-2xl font-bold flex items-center gap-2">
                    {{ currentTime }} 
                    <span class="text-[11px] bg-black/10 px-3 py-1 rounded-full font-normal tracking-tighter">{{ currentLocationName }}</span>
                </h1>
                <div @click="getLocation" class="flex items-center mt-3 text-sm bg-white/20 p-3 rounded-2xl backdrop-blur-md active:scale-95 transition-all cursor-pointer">
                    <i v-if="weather" :class="getWeatherIcon(weather.code)" class="text-xl mr-2 text-yellow-200"></i>
                    <div v-if="weather">
                        <p class="font-bold">{{ weather.temp }}Â°C <span class="text-[10px] font-normal opacity-80">{{ travelTip }}</span></p>
                    </div>
                    <div v-else class="text-xs animate-pulse">ç²å–ç•¶åœ°å¤©æ°£ä¸­...</div>
                </div>
            </div>
            <button @click="showDateSettings = true" class="bg-white/30 w-11 h-11 rounded-full flex items-center justify-center active:scale-90 ml-3">
                <i class="fa-solid fa-calendar-day text-lg"></i>
            </button>
        </div>

        <div class="flex space-x-3 overflow-x-auto no-scrollbar mt-6 py-2 px-1">
            <button v-for="(day, i) in itinerary" :key="i" @click="activeDayIdx = i"
                :class="activeDayIdx === i ? 'day-tab-active' : 'day-tab-normal'"
                class="px-4 py-3 rounded-2xl text-xs font-bold flex-shrink-0 flex flex-col items-center min-w-[100px] transition-all">
                <span class="text-[9px] uppercase opacity-70 mb-0.5">Day {{ i + 1 }}</span>
                <span class="text-base leading-tight">{{ getDisplayDate(i) }}</span>
                <span class="text-[10px] font-normal mt-0.5">{{ getDayOfWeek(i) }}</span>
            </button>
            <button @click="addDay" class="px-6 py-3 bg-white/10 rounded-2xl border-2 border-dashed border-white/40"><i class="fa-solid fa-plus"></i></button>
        </div>
    </header>

    <main class="p-5">
        <div ref="sortableList" class="space-y-6">
            <div v-for="(event, eIdx) in itinerary[activeDayIdx].events" :key="event.id" 
                class="kawaii-card p-5 relative border-l-[10px]" :style="{ borderColor: getCategoryColor(event.category) }"
                @click="openEditModal(eIdx)">
                
                <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-black bg-[#f0f9f9] text-[#64cccc] px-3 py-1 rounded-lg">{{ event.time }}</span>
                        <span class="text-sm font-bold">{{ getCategoryEmoji(event.category) }} {{ getCategoryName(event.category) }}</span>
                    </div>
                    <span v-if="event.cost > 0" class="text-sm font-bold text-rose-400">Â¥{{ event.cost.toLocaleString() }}</span>
                </div>

                <h3 class="font-bold text-[#2d5a5a] text-xl mb-1">{{ event.location }}</h3>
                <p v-if="event.note" class="text-xs text-gray-400 italic line-clamp-2">"{{ event.note }}"</p>
                <img v-if="event.image" :src="event.image" class="img-box shadow-sm">

                <div class="flex justify-end mt-4">
                    <button @click.stop="openGoogleMap(event.location)" class="flex items-center gap-2 bg-[#64cccc]/10 text-[#64cccc] px-4 py-2 rounded-full text-xs font-bold active:scale-95 transition-all">
                        <i class="fa-solid fa-map-location-dot"></i> å°èˆª
                    </button>
                </div>
            </div>
        </div>

        <div v-if="itinerary[activeDayIdx].events.length > 0" class="mt-10 p-5 bg-[#f0f9f9] rounded-[2rem] text-center border-2 border-dashed border-[#64cccc]/30">
            <p class="text-[10px] text-[#88babb] font-black uppercase tracking-[0.2em] mb-1">Daily Total Budget</p>
            <p class="text-2xl font-black text-[#64cccc]">Â¥ {{ dailyTotal.toLocaleString() }}</p>
        </div>
        
        <div v-else class="text-center py-24 text-gray-300">
            <i class="fa-solid fa-suitcase-rolling text-5xl mb-4 opacity-20"></i>
            <p class="text-sm italic">æœªæœ‰è¡Œç¨‹ï¼Œæ’³ä¸‹é¢ + æ£é–‹å§‹å•¦ï¼</p>
        </div>
    </main>

    <button @click="addNewEvent" class="fixed bottom-32 right-8 bg-[#64cccc] text-white w-16 h-16 rounded-full shadow-[0_10px_30px_rgba(100,204,204,0.4)] z-30 flex items-center justify-center text-3xl active:scale-90 transition-all">
        <i class="fa-solid fa-plus"></i>
    </button>

    <div v-if="showDateSettings" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-8">
        <div class="bg-white w-full max-w-xs rounded-[2.5rem] p-8 shadow-2xl">
            <h3 class="font-bold text-xl text-center mb-6">ğŸ—“ï¸ è¨­å®šå‡ºç™¼æ—¥æœŸ</h3>
            <div class="bg-[#f0f9f9] rounded-2xl p-2 mb-6">
                <input v-model="startDate" type="date" class="w-full p-4 bg-transparent outline-none font-bold text-center text-[#2d5a5a] text-lg">
            </div>
            <button @click="confirmDate" class="w-full bg-[#64cccc] text-white py-4 rounded-2xl font-bold shadow-lg active:scale-95 transition-all">å„²å­˜ä¸¦æ›´æ–°</button>
        </div>
    </div>

    <div v-if="showEditModal" class="fixed inset-0 bg-black/50 z-[90] flex items-end">
        <div class="bg-white w-full rounded-t-[3rem] p-8 max-h-[92vh] overflow-y-auto no-scrollbar shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-2xl text-[#2d5a5a]">{{ isNew ? 'âœ¨ æ–°å¢è¡Œç¨‹' : 'ğŸ“ ç·¨è¼¯å…§å®¹' }}</h3>
                <i @click="showEditModal = false" class="fa-solid fa-xmark text-gray-300 text-2xl p-2"></i>
            </div>
            
            <div class="space-y-5">
                <div class="flex gap-2 overflow-x-auto no-scrollbar py-2">