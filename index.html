<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„æ—…è¡Œç­†è¨˜ V28 âœˆï¸</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-blue: #64cccc; --bg-light: #f4fbfb; --text-dark: #2d5a5a; }
        body { background-color: var(--bg-light); font-family: 'Zen Maru Gothic', sans-serif; color: var(--text-dark); overflow-x: hidden; }
        .app-container { max-width: 480px; margin: 0 auto; min-height: 100vh; padding-bottom: 110px; }
        
        .top-nav { background: var(--primary-blue); color: white; border-radius: 0 0 2.5rem 2.5rem; padding: 2.5rem 1.5rem 2rem; box-shadow: 0 4px 20px rgba(100,204,204,0.15); }
        .top-icon-btn { width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; color: white; }

        .day-tab { min-width: 60px; height: 75px; border-radius: 20px; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid transparent; transition: 0.3s; }
        .day-tab.active { border-color: var(--primary-blue); background: #f0fdfd; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(100,204,204,0.1); }

        .card-flight { background: white; border: 2px dashed #b2e2e2; border-radius: 24px; padding: 20px; position: relative; }
        .card-event { background: white; border-radius: 24px; padding: 18px; border: 1px solid #eef7f7; box-shadow: 0 4px 12px rgba(0,0,0,0.02); position: relative; }
        
        /* ğŸ—ºï¸ åœ°åœ–å°èˆªæŒ‰éˆ•æ¨£å¼ */
        .map-trigger { position: absolute; bottom: 15px; right: 15px; width: 36px; height: 36px; border-radius: 10px; background: #f0f9f9; color: var(--primary-blue); display: flex; align-items: center; justify-content: center; font-size: 16px; transition: 0.2s; }
        .map-trigger:active { scale: 0.9; background: #e0f2f2; }

        .fab-add { position: fixed; bottom: 35px; right: 25px; width: 60px; height: 60px; border-radius: 50%; background: var(--primary-blue); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 10px 25px rgba(100,204,204,0.3); z-index: 90; border: 4px solid white; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .modal-overlay { background: rgba(45, 90, 90, 0.4); backdrop-filter: blur(6px); }
    </style>
</head>
<body>

<div id="app" class="app-container">
    <header class="top-nav mb-6">
        <div class="flex justify-between items-start mb-4">
            <div>
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-2xl font-black">{{ currentTime }}</span>
                    <span class="bg-white/20 px-3 py-0.5 rounded-full text-[10px] font-bold">{{ currentLocationName }}</span>
                </div>
                <h1 class="text-xs font-bold opacity-80 italic tracking-widest uppercase">Travel Planner</h1>
            </div>
            <div class="flex gap-2">
                <button @click="showExpenseReport = true" class="top-icon-btn"><i class="fa-solid fa-chart-pie"></i></button>
                <button @click="showSettings = true" class="top-icon-btn"><i class="fa-solid fa-sliders"></i></button>
            </div>
        </div>
        <div class="bg-white/20 backdrop-blur-md p-4 rounded-3xl flex items-center gap-4">
            <span class="text-3xl">â˜€ï¸</span>
            <p class="text-[10px] font-bold">{{ weatherTemp }}Â° C æ–¼ç•¶åœ° <br><span class="opacity-70 italic font-normal">å¤©æ°£ä¸éŒ¯ï¼Œæº–å‚™å‡ºç™¼ï¼</span></p>
        </div>
    </header>

    <div class="px-6 mb-8 overflow-x-auto flex gap-3 no-scrollbar py-2">
        <div v-for="(day, i) in itinerary" :key="i" @click="activeDayIdx = i"
            class="day-tab" :class="{ active: activeDayIdx === i }">
            <span class="text-[8px] font-bold opacity-30">DAY {{ i + 1 }}</span>
            <span class="text-lg font-black text-[#64cccc]">{{ getDisplayDate(i) }}</span>
        </div>
        <button @click="addDay" class="day-tab border-dashed opacity-40 text-xl text-[#64cccc]">+</button>
    </div>

    <main class="px-6 space-y-4">
        <div class="flex items-center gap-2 mb-2">
            <div class="w-1.5 h-5 bg-[#64cccc] rounded-full"></div>
            <h2 class="font-black text-sm uppercase tracking-wider text-gray-400">è¡Œç¨‹å®‰æ’</h2>
        </div>

        <div ref="sortableList" class="space-y-4">
            <div v-for="(event, eIdx) in itinerary[activeDayIdx].events" :key="event.id" class="relative">
                
                <div v-if="event.category === 'flight'" @click="openEditModal(eIdx)" class="card-flight">
                    <div class="flex justify-between items-center mb-4 text-[10px] font-bold text-[#64cccc]">
                        <span>FLIGHT MODE</span>
                        <span class="opacity-40">{{ event.flightNum || 'æœªè¼¸å…¥èˆªç­' }}</span>
                    </div>
                    <div class="flex justify-between items-center px-2">
                        <div class="text-center">
                            <p class="text-2xl font-black uppercase">{{ event.from || '---' }}</p>
                            <p class="text-[10px] opacity-40">{{ event.time }}</p>
                        </div>
                        <i class="fa-solid fa-plane text-[#64cccc] opacity-30 text-xl"></i>
                        <div class="text-center">
                            <p class="text-2xl font-black uppercase">{{ event.to || '---' }}</p>
                            <p class="text-[10px] opacity-40">{{ event.arrivalTime || '--:--' }}</p>
                        </div>
                    </div>
                </div>

                <div v-else @click="openEditModal(eIdx)" class="card-event">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <span class="text-xl">{{ getCategoryEmoji(event.category) }}</span>
                            <span class="text-[10px] font-black bg-gray-50 px-2 py-0.5 rounded text-gray-400">{{ event.time }}</span>
                        </div>
                        <p v-if="event.cost > 0" class="text-xs font-black text-[#64cccc]">
                            {{ event.currency === 'JPY' ? 'Â¥' : '$' }}{{ event.cost.toLocaleString() }}
                        </p>
                    </div>
                    <h3 class="text-lg font-black pr-12">{{ event.location || 'æ–°è¡Œç¨‹' }}</h3>
                    <p v-if="event.note" class="text-[10px] opacity-40 mt-1 italic">âœ {{ event.note }}</p>
                    
                    <button @click.stop="openMap(event.mapUrl)" class="map-trigger">
                        <i class="fa-solid fa-map-location-dot"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <button @click="addNewEvent" class="fab-add shadow-lg"><i class="fa-solid fa-plus"></i></button>

    <div v-if="showExpenseReport" class="fixed inset-0 z-[100] flex items-end modal-overlay">
        <div @click="showExpenseReport = false" class="absolute inset-0"></div>
        <div class="bg-white w-full rounded-t-[3rem] p-8 relative max-h-[85vh] overflow-y-auto no-scrollbar">
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
            <h3 class="text-xl font-black text-center mb-8">ä»Šæ—¥é–‹æ”¯å ±è¡¨ ğŸ“Š</h3>
            <div class="bg-[#64cccc] p-6 rounded-[2.5rem] text-center text-white shadow-lg mb-8">
                <p class="text-[10px] font-bold opacity-70 uppercase mb-1">TOTAL EXPENSES (HKD)</p>
                <p class="text-3xl font-black">$ {{ dailyTotalHKD.toFixed(1) }}</p>
            </div>
            <div class="space-y-3">
                <div v-for="stat in categoryStats" :key="stat.name" class="flex justify-between items-center bg-gray-50 p-5 rounded-2xl">
                    <span class="font-bold">{{ stat.emoji }} {{ stat.name }}</span>
                    <span class="font-black text-rose-400">$ {{ stat.totalHKD.toFixed(1) }}</span>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showEditModal" class="fixed inset-0 z-[110] flex items-end modal-overlay">
        <div class="bg-white w-full rounded-t-[3rem] p-8 max-h-[92vh] overflow-y-auto no-scrollbar">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-black text-lg">{{ isNew ? 'âœ¨ æ–°å¢è¡Œç¨‹' : 'ğŸ“ ç·¨è¼¯è¡Œç¨‹' }}</h3>
                <button @click="showEditModal = false" class="text-gray-300 text-2xl">Ã—</button>
            </div>

            <div class="space-y-5">
                <div class="flex gap-2 overflow-x-auto no-scrollbar py-1">
                    <button v-for="cat in categories" :key="cat.id" @click="editingEvent.category = cat.id"
                        :class="editingEvent.category === cat.id ? 'bg-[#64cccc] text-white shadow-md' : 'bg-gray-50 text-gray-400'"
                        class="px-5 py-4 rounded-2xl flex flex-col items-center min-w-[75px]">
                        <span class="text-2xl mb-1">{{ cat.emoji }}</span>
                        <span class="text-[10px] font-bold">{{ cat.name }}</span>
                    </button>
                </div>

                <div v-if="editingEvent.category === 'flight'" class="bg-gray-50 p-6 rounded-[2.5rem] space-y-4">
                    <div class="flex gap-3">
                        <input v-model="editingEvent.from" placeholder="HKG" class="p-4 bg-white rounded-2xl flex-1 font-bold text-center uppercase border-none">
                        <div class="flex items-center text-[#64cccc]"><i class="fa-solid fa-plane"></i></div>
                        <input v-model="editingEvent.to" placeholder="NRT" class="p-4 bg-white rounded-2xl flex-1 font-bold text-center uppercase border-none">
                    </div>
                    <div class="flex gap-3">
                        <input v-model="editingEvent.time" type="time" class="p-4 bg-white rounded-2xl flex-1 font-bold">
                        <input v-model="editingEvent.arrivalTime" type="time" class="p-4 bg-white rounded-2xl flex-1 font-bold">
                    </div>
                    <input v-model="editingEvent.flightNum" placeholder="èˆªç­ç·¨è™Ÿ (å¦‚ CX504)" class="w-full p-4 bg-white rounded-2xl font-bold uppercase">
                </div>

                <div v-else class="space-y-4">
                    <div class="flex gap-3">
                        <input v-model="editingEvent.time" type="time" class="p-4 bg-gray-50 rounded-2xl flex-1 font-bold border-none">
                        <input v-model="editingEvent.location" placeholder="åœ°é»/ç›®çš„åœ°" class="p-4 bg-gray-50 rounded-2xl flex-[2.5] font-bold border-none">
                    </div>
                    <div class="relative">
                        <i class="fa-solid fa-link absolute left-4 top-1/2 -translate-y-1/2 text-[#64cccc] text-xs"></i>
                        <input v-model="editingEvent.mapUrl" placeholder="ç²˜è²¼ Google Map å°èˆªé€£çµ..." class="w-full p-4 pl-10 bg-gray-50 rounded-2xl text-xs font-bold border-none">
                    </div>
                </div>

                <textarea v-model="editingEvent.note" placeholder="å¯«å•²å‚™è¨»..." class="w-full p-5 bg-gray-50 rounded-2xl h-24 text-sm outline-none resize-none"></textarea>

                <div class="bg-cyan-50/50 p-6 rounded-[2.5rem]">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-xs font-black text-[#64cccc]">é–‹æ”¯è²»ç”¨</span>
                        <div class="flex bg-white rounded-xl p-1 shadow-sm">
                            <button @click="editingEvent.currency = 'JPY'" :class="editingEvent.currency === 'JPY' ? 'bg-[#64cccc] text-white' : 'text-gray-300'" class="px-3 py-1 rounded-lg text-[10px] font-bold">JPY Â¥</button>
                            <button @click="editingEvent.currency = 'HKD'" :class="editingEvent.currency === 'HKD' ? 'bg-[#64cccc] text-white' : 'text-gray-300'" class="px-3 py-1 rounded-lg text-[10px] font-bold">HKD $</button>
                        </div>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span class="text-2xl font-black text-[#64cccc] opacity-50">{{ editingEvent.currency === 'JPY' ? 'Â¥' : '$' }}</span>
                        <input v-model.number="editingEvent.cost" type="number" class="bg-transparent w-full outline-none font-black text-3xl text-[#64cccc]" placeholder="0">
                    </div>
                </div>

                <div @click="$refs.fileInput.click()" class="border-2 border-dashed border-[#64cccc] rounded-[2rem] p-8 text-center bg-[#f9fdfd]">
                    <div v-if="!editingEvent.image">
                        <i class="fa-solid fa-camera text-[#64cccc] text-2xl mb-2"></i>
                        <p class="text-[10px] font-bold text-[#64cccc]">åŠ å…¥ç›¸ç‰‡ / å½±ç›¸</p>
                    </div>
                    <img v-else :src="editingEvent.image" class="w-full rounded-2xl shadow-sm">
                    <input type="file" ref="fileInput" @change="handleImageUpload" class="hidden" accept="image/*">
                </div>
            </div>

            <div class="flex gap-4 mt-8 pb-4">
                <button v-if="!isNew" @click="deleteEvent" class="flex-1 py-4 text-rose-400 font-bold">åˆªé™¤è¡Œç¨‹</button>
                <button @click="saveEvent" class="flex-[3] bg-[#64cccc] text-white py-4 rounded-2xl font-black shadow-lg">å„²å­˜ä¸¦è¿”å›</button>
            </div>
        </div>
    </div>

    <div v-if="showSettings" class="fixed inset-0 z-[120] flex items-center justify-center p-8 modal-overlay">
        <div class="bg-white w-full max-w-xs rounded-[2.5rem] p-8 shadow-2xl">
            <h3 class="font-black text-center mb-6 text-[#64cccc]">æ—…ç¨‹åå¥½è¨­å®š</h3>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold text-gray-300 ml-2">å‡ºç™¼æ—¥æœŸ</label>
                    <input v-model="startDate" type="date" class="w-full p-4 bg-gray-50 rounded-2xl font-bold border-none outline-none mt-1">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-300 ml-2">JPY åŒ¯ç‡ (å¦‚ 0.052)</label>
                    <input v-model.number="exchangeRate" type="number" step="0.001" class="w-full p-4 bg-gray-50 rounded-2xl font-bold border-none outline-none mt-1">
                </div>
            </div>
            <button @click="showSettings = false; saveToLocal();" class="w-full bg-[#64cccc] text-white py-4 rounded-2xl font-black mt-8 shadow-md">å„²å­˜è¨­å®š</button>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;
createApp({
    data() {
        return {
            activeDayIdx: 0, showEditModal: false, showExpenseReport: false, showSettings: false, isNew: true, editingIdx: -1,
            currentTime: '00:00', currentLocationName: 'æ²™ç”°å€', weatherTemp: 13, exchangeRate: 0.052, startDate: '2026-01-11',
            itinerary: [{ events: [] }],
            categories: [
                { id: 'spot', name: 'æ™¯é»', emoji: 'ğŸŒ¸' },
                { id: 'eat', name: 'é£²é£Ÿ', emoji: 'ğŸ±' },
                { id: 'shop', name: 'è³¼ç‰©', emoji: 'ğŸ›ï¸' },
                { id: 'hotel', name: 'é…’åº—', emoji: 'ğŸ¨' },
                { id: 'transport', name: 'äº¤é€š', emoji: 'ğŸšƒ' },
                { id: 'flight', name: 'èˆªç­', emoji: 'âœˆï¸' }
            ],
            editingEvent: { id: 0, time: '12:00', arrivalTime: '', from: '', to: '', flightNum: '', location: '', mapUrl: '', cost: 0, note: '', currency: 'JPY', category: 'spot', image: '' }
        }
    },
    methods: {
        getEventHKD(e) { return e.currency === 'JPY' ? (e.cost || 0) * this.exchangeRate : (e.cost || 0); },
        getDisplayDate(i) {
            const d = new Date(this.startDate); d.setDate(d.getDate() + i);
            return `${d.getMonth() + 1}/${d.getDate()}`;
        },
        getCategoryEmoji(id) { return this.categories.find(c => c.id === id)?.emoji || 'ğŸ“'; },
        openMap(url) {
            if(url) window.open(url, '_blank');
            else alert('æœªè¨­ç½®å°èˆªé€£çµï¼Œè«‹é»æ“Šè¡Œç¨‹é€²è¡Œç·¨è¼¯ã€‚');
        },
        handleImageUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (f) => this.editingEvent.image = f.target.result;
                reader.readAsDataURL(file);
            }
        },
        addNewEvent() {
            this.isNew = true;
            this.editingEvent = { id: Date.now(), time: '12:00', arrivalTime: '', from: '', to: '', flightNum: '', location: '', mapUrl: '', cost: 0, note: '', currency: 'JPY', category: 'spot', image: '' };
            this.showEditModal = true;
        },
        openEditModal(idx) {
            this.isNew = false; this.editingIdx = idx;
            this.editingEvent = JSON.parse(JSON.stringify(this.itinerary[this.activeDayIdx].events[idx]));
            this.showEditModal = true;
        },
        saveEvent() {
            if(this.isNew) this.itinerary[this.activeDayIdx].events.push({...this.editingEvent});
            else this.itinerary[this.activeDayIdx].events[this.editingIdx] = {...this.editingEvent};
            this.itinerary[this.activeDayIdx].events.sort((a,b) => a.time.localeCompare(b.time));
            this.showEditModal = false; this.saveToLocal();
        },
        deleteEvent() {
            if(confirm('ç¢ºå®šåˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) { this.itinerary[this.activeDayIdx].events.splice(this.editingIdx, 1); this.showEditModal = false; this.saveToLocal(); }
        },
        addDay() { this.itinerary.push({ events: [] }); this.saveToLocal(); },
        saveToLocal() { localStorage.setItem('travel_blue_v28_final', JSON.stringify({ i: this.itinerary, s: this.startDate, r: this.exchangeRate })); },
        updateTime() {
            const now = new Date();
            this.currentTime = now.toLocaleTimeString('zh-HK', { hour12: false, hour: '2-digit', minute: '2-digit' });
        }
    },
    computed: {
        dailyTotalHKD() { return this.itinerary[this.activeDayIdx].events.reduce((sum, e) => sum + this.getEventHKD(e), 0); },
        categoryStats() {
            return this.categories.map(cat => {
                const totalHKD = this.itinerary[this.activeDayIdx].events.filter(e => e.category === cat.id).reduce((sum, e) => sum + this.getEventHKD(e), 0);
                return { ...cat, totalHKD };
            }).filter(s => s.totalHKD > 0);
        }
    },
    mounted() {
        const saved = JSON.parse(localStorage.getItem('travel_blue_v28_final'));
        if(saved) { this.itinerary = saved.i; this.startDate = saved.s; this.exchangeRate = saved.r || 0.052; }
        this.updateTime(); setInterval(this.updateTime, 10000);
        Sortable.create(this.$refs.sortableList, { animation: 200, onEnd: () => this.saveToLocal() });
    }
}).mount('#app');
</script>
</body>
</html>